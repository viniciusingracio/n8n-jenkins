- include_role:
    name: mconf-live

- name: Disable services not needed
  become: yes
  service:
    name: '{{ item }}'
    state: stopped
    enabled: no
  with_items:
    - red5
    - libreoffice
    - freeswitch
    - kurento-media-server
    - bbb-apps-akka
    - bbb-transcode-akka
    - bbb-fsesl-akka
    - bbb-webrtc-sfu
    - mconf-mcs-sip
    - bbb-html5
  ignore_errors: yes

- include: server.yml
  when: mconf_rec_share_nfs

- include: client.yml
  when: mconf_rec_mount_nfs

- name: Check if mconf_decrypter is installed
  stat:
    path: /usr/local/bigbluebutton/core/scripts/mconf-decrypter.yml
  register: reg_decrypter

- name: Adjust mconf-presentation-recorder.yml
  yedit:
    src: /usr/local/bigbluebutton/core/scripts/mconf-decrypter.yml 
    edits:
    - { key: 'get_recordings_url', value: '{{ mconf_rec_get_recordings_url }}' }
    - { key: 'verify_ssl_certificate', value: '{{ not use_self_signed_certificate | default(true) }}' }
    state: present
  become: yes
  when: reg_decrypter.stat.exists
