- name: Create remote user
  become: true
  user:
    name: '{{ deploy_user }}'
    shell: /bin/bash
    groups: adm,sudo,syslog
    append: yes

- name: Set up authorized keys
  become: true
  authorized_key:
    user: '{{ deploy_user }}'
    state: present
    key: '{{ item }}'
  with_file:
    - public_keys/daronco.pub

- name: Add to sudoers
  become: true
  lineinfile:
    dest: /etc/sudoers
    state: present
    regexp: '^{{ deploy_user }}\s'
    line: '{{ deploy_user }} ALL=(ALL) NOPASSWD: ALL'
    validate: 'visudo -cf %s'

- name: Update apt
  become: true
  apt: update_cache=yes

- name: Install common packages
  become: true
  apt:
    name: '{{ item }}'
    state: present
  with_items:
    - curl
    - git
    - wget
    - htop
    - vim

- include: ufw.yml tags=ufw,firewall
