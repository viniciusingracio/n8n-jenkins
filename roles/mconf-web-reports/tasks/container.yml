- name: Pull the docker image
  docker_image:
    name: '{{ mconf_web_reports_image }}:{{ mconf_web_reports_image_version }}'

- name: Setup cron to run the container
  become: true
  cron:
    name: update reports
    minute: 5
    user: root
    job: "docker run --rm -v /root/mconf-web-reports-config.yml:/usr/src/app/config.yml -v /root/mconf-web-reports.env.local:/usr/src/app/.env.local -v {{ mconf_web_reports_output_dir }}:/usr/src/app/output -e SAVE_TO=/usr/src/app/output {{ mconf_web_reports_image }}:{{ mconf_web_reports_image_version }}"
    cron_file: mconf-web-reports-run

# - name: Run the container
#   docker_container:
#     name: mconf-web-reports
#     image: '{{ mconf_web_reports_image }}:{{ mconf_web_reports_image_version }}'
#     volumes:
#       - '{{ mconf_web_reports_output_dir }}:/usr/src/app/output'
#       - /root/mconf-web-reports.env.local:/usr/src/app/.env.local
#       - /root/mconf-web-reports-config.yml:/usr/src/app/config.yml
#     env:
#       SAVE_TO: /usr/src/app/output
