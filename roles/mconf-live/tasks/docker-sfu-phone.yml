- name: Start sfu-phone container
  docker_container:
    name: sfu-phone
    image: '{{ bigbluebutton_docker_sfu_phone_image }}'
    pull: yes
    restart_policy: unless-stopped
    ports:
      - 3011:3011
    env:
      REDIS_HOST: '{{ docker_ip }}'
      MCS_PORT: "3009"
      MCS_HOST: '{{ docker_ip }}'
      SIP_API_ADDRESS: wss://{{ inventory_hostname }}/mcs-sip
      ENABLE_REGISTER: '{{ bigbluebutton_sip_registrar_enabled | string }}'
  notify: restart docker components

- name: Remove old images
  shell: docker images {{ bigbluebutton_docker_sfu_phone_image.split(":")[0] }} --filter 'before={{ bigbluebutton_docker_sfu_phone_image }}' -q | xargs -r docker rmi --force
  notify: clean docker
