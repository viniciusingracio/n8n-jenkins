- name: Start bbb-webhooks container
  docker_container:
    name: webhooks
    image: mconf/bbb-webhooks
    pull: yes
    restart_policy: unless-stopped
    ports:
      - "3005:3005"
    env:
      REDIS_HOST: '{{ docker_ip }}'
      SHARED_SECRET: '{{ bbb_secret }}'
      BEARER_AUTH: 1
      SERVER_DOMAIN: '{{ inventory_hostname }}'
    state: '{% if mconf_live_webhooks %}started{% else %}absent{% endif %}'

- name: Add webhooks to nginx
  become: yes
  copy:
    src: files/webhooks.nginx
    dest: /etc/bigbluebutton/nginx/webhooks.nginx
  when: mconf_live_webhooks
  notify: reload nginx

- name: Remove webhooks from nginx
  become: yes
  file:
    path: /etc/bigbluebutton/nginx/webhooks.nginx
    state: absent
  when: not mconf_live_webhooks
  notify: reload nginx

