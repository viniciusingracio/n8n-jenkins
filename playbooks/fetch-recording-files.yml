---

- hosts: localhost
  tasks:
  - file:
      path: /tmp/recording-files
      state: directory

- hosts:
  - mconf-live220
  - mconf-rec
  - mconf-recw
  tasks:
  - name: Copy files
    command: rsync -azm -e 'ssh -p {{ ansible_port }} {{ ansible_ssh_common_args }}' {{ ansible_user }}@{{ inventory_hostname }}:/var/bigbluebutton/{published,unpublished,deleted} /tmp/recording-files/
    delegate_to: 127.0.0.1
    retries: 10
    delay: 2
    register: task_result
    until: task_result.rc == 0
